//
//  ZJAddressPickerView.m
//  ZJKitTool
//
//  Created by ÈÇìÂøóÂùö on 2018/6/28.
//  Copyright ¬© 2018Âπ¥ kapokcloud. All rights reserved.
//
/**
 *  ZJKitTool
 *
 *  GitHubÂú∞ÂùÄÔºöhttps://github.com/Dzhijian/ZJKitTool
 *
 *  Êú¨Â∫ì‰ºö‰∏çÊñ≠Êõ¥Êñ∞Â∑•ÂÖ∑Á±ªÔºå‰ª•ÂèäÊ∑ªÂä†‰∏Ä‰∫õÊ®°ÂùóÊ°à‰æãÔºåËØ∑ÂêÑ‰ΩçÂ§ßÁ•û‰ª¨Â§öÂ§öÊåáÊïôÔºåÊîØÊåÅ‰∏Ä‰∏ã,Áªô‰∏™Star„ÄÇüòÜ
 */

#import "ZJAddressPickerView.h"
#import "ZJPickerViewMacro.h"

@interface ZJAddressPickerView ()<UIPickerViewDelegate,UIPickerViewDataSource>
{
    UIView *_selectBackView;
//    BOOL _isDataSourceValid;    // Êï∞ÊçÆÊ∫êÊòØÂê¶ÂêàÊ≥ï
    NSInteger _provinceIndex;   // ËÆ∞ÂΩïÁúÅÈÄâ‰∏≠ÁöÑ‰ΩçÁΩÆ
    NSInteger _cityIndex;       // ËÆ∞ÂΩïÂ∏ÇÈÄâ‰∏≠ÁöÑ‰ΩçÁΩÆ
    NSInteger _areaIndex;       // ËÆ∞ÂΩïÂå∫ÈÄâ‰∏≠ÁöÑ‰ΩçÁΩÆ
    NSArray * _defaultSelectedArr;
}
/// Êï∞ÊçÆÊ∫ê
@property (nonatomic, strong) NSArray               *dataSource;
/// Âú∞ÂùÄÈÄâÊã©Âô®
@property (nonatomic, strong) UIPickerView          *pickerView;
/// ÁúÅÊ®°ÂûãÊï∞ÁªÑ
@property (nonatomic, strong) NSArray               *provinceArr;
/// Â∏ÇÊ®°ÂûãÊï∞ÁªÑ
@property (nonatomic, strong) NSArray               *cityArr;
/// Âå∫Ê®°ÂûãÊï∞ÁªÑ
@property (nonatomic, strong) NSArray               *areaArr;
/// ÈÄâ‰∏≠ÁöÑÁúÅ
@property(nonatomic, strong) ZJProvinceModel        *selectProvinceModel;
/// ÈÄâ‰∏≠ÁöÑÂ∏Ç
@property(nonatomic, strong) ZJCityModel            *selectCityModel;
/// ÈÄâ‰∏≠ÁöÑÂå∫
@property(nonatomic, strong) ZJAreaModel            *selectAreaModel;
@end


@implementation ZJAddressPickerView

#pragma mark - 1.ÊòæÁ§∫Âú∞ÂùÄÈÄâÊã©Âô®
+(void)zj_showAddressPickerWithDefaultSelected:(NSArray *)defaultSeleArr
                                   resuleBlock:(ZJAddressResultBlock)resultBlock{
    
    [self zj_showAddressPickerWithDefaultSelected:defaultSeleArr
                                     isAutoSelect:NO
                                      resultBlock:resultBlock];
    
}


+ (void)zj_showAddressPickerWithDefaultSelected:(NSArray *)defaultSelectedArr
                                   isAutoSelect:(BOOL)isAutoSelect
                                    resultBlock:(ZJAddressResultBlock)resultBlock{
    
    [self zj_showAddressPickerWithShowType:ZJAddressPickerModeArea
                           defaultSelected:defaultSelectedArr
                              isAutoSelect:isAutoSelect
                               resultBlock:resultBlock
                               cancelBlock:nil];
    
}
+ (void)zj_showAddressPickerWithShowType:(ZJAddressPickerMode)pickerMode
                         defaultSelected:(NSArray *)defaultSelectedArr
                            isAutoSelect:(BOOL)isAutoSelect
                             resultBlock:(ZJAddressResultBlock)resultBlock
                             cancelBlock:(ZJAddressCancelBlock)cancelBlock{
    
    [self zj_showAddressPickerWithShowType:pickerMode
                                dataSource:nil
                           defaultSelected:defaultSelectedArr
                              isAutoSelect:isAutoSelect
                               resultBlock:resultBlock
                               cancelBlock:cancelBlock];
}

+ (void)zj_showAddressPickerWithShowType:(ZJAddressPickerMode)pickerMode
                           dataSource:(NSArray *)dataSource
                      defaultSelected:(NSArray *)defaultSelectedArr
                         isAutoSelect:(BOOL)isAutoSelect
                          resultBlock:(ZJAddressResultBlock)resultBlock
                          cancelBlock:(ZJAddressCancelBlock)cancelBlock{
    
    [self zj_showAddressPickerWithShowType:pickerMode
                                dataSource:dataSource
                           defaultSelected:defaultSelectedArr
                              isAutoSelect:isAutoSelect
                                 lineColor:nil
                        selectRowTextColor:nil
                          selectRowBGColor:nil
                      confirmBtnTitleColor:nil
                       cancelBtnTitleColor:nil
                                 rowHeight:0
                               resultBlock:resultBlock
                               cancelBlock:cancelBlock];
    
}
+ (void)zj_showAddressPickerWithShowType:(ZJAddressPickerMode)pickerMode
                               dataSource:(NSArray *)dataSource
                          defaultSelected:(NSArray *)defaultSelectedArr
                             isAutoSelect:(BOOL)isAutoSelect
                                lineColor:(UIColor *)lineColor
                       selectRowTextColor:(UIColor *)selectRowTextColor
                         selectRowBGColor:(UIColor *)selectRowBGColor
                              resultBlock:(ZJAddressResultBlock)resultBlock
                             cancelBlock:(ZJAddressCancelBlock)cancelBlock{
    
    [self zj_showAddressPickerWithShowType:pickerMode
                                dataSource:dataSource
                           defaultSelected:defaultSelectedArr
                              isAutoSelect:isAutoSelect
                                 lineColor:lineColor
                        selectRowTextColor:selectRowTextColor
                          selectRowBGColor:selectRowBGColor
                      confirmBtnTitleColor:nil
                       cancelBtnTitleColor:nil
                                 rowHeight:0
                               resultBlock:resultBlock
                               cancelBlock:cancelBlock];
}

+ (void)zj_showAddressPickerWithShowType:(ZJAddressPickerMode)pickerMode
                              dataSource:(NSArray *)dataSource
                         defaultSelected:(NSArray *)defaultSelectedArr
                            isAutoSelect:(BOOL)isAutoSelect
                               lineColor:(UIColor *)lineColor
                      selectRowTextColor:(UIColor *)selectRowTextColor
                        selectRowBGColor:(UIColor *)selectRowBGColor
                    confirmBtnTitleColor:(UIColor *)confirmBtnTitleColor
                     cancelBtnTitleColor:(UIColor *)cancelBtnTitleColor
                               rowHeight:(CGFloat)rowHeight
                             resultBlock:(ZJAddressResultBlock)resultBlock
                             cancelBlock:(ZJAddressCancelBlock)cancelBlock{
    
    ZJAddressPickerView *addressPickerView = [[ZJAddressPickerView alloc]
                                              initWithShowPickerViewMode:pickerMode
                                              dataSource:dataSource
                                              defaultSelected:defaultSelectedArr
                                              isAutoSelected:isAutoSelect
                                              lineColor:lineColor
                                              selectRowTextColor:selectRowTextColor
                                              selectRowBGColor:selectRowBGColor
                                              confirmBtnTitleColor:confirmBtnTitleColor
                                              cancelBtnTitleColor:cancelBtnTitleColor
                                              rowHeight:rowHeight
                                              resultBlock:resultBlock
                                              cancelBlock:cancelBlock];
    
    [addressPickerView showPickerViewWithAnimation:YES];
    
}

- (void)setPickerViewMode:(ZJAddressPickerMode)pickerViewMode{
    _pickerViewMode = pickerViewMode;
}

- (void)setResultBlock:(ZJAddressResultBlock)resultBlock{
    _resultBlock = resultBlock;
}

- (void)setCancelBlock:(ZJAddressCancelBlock)cancelBlock{
    _cancelBlock = cancelBlock;
}
//- (void)setLineColor:(UIColor *)lineColor{
//    _lineColor = lineColor;
//}
- (void)setSelecteRowTextColor:(UIColor *)selecteRowTextColor{
    _selecteRowTextColor = selecteRowTextColor;
}

- (void)setSelectRowBGColor:(UIColor *)selectRowBGColor{
    _selectRowBGColor = selectRowBGColor;
}

- (void)setRowHeight:(CGFloat)rowHeight{
    _rowHeight = rowHeight;
}

- (void)setLeftBtnTitleColor:(UIColor *)leftBtnTitleColor{
    _leftBtnTitleColor = leftBtnTitleColor;
    [self.leftBtn setTitleColor:leftBtnTitleColor forState:(UIControlStateNormal)];

}

- (void)setRightBtnTitleColor:(UIColor *)rightBtnTitleColor {
    _rightBtnTitleColor = rightBtnTitleColor;
    [self.rightBtn setTitleColor:rightBtnTitleColor forState:(UIControlStateNormal)];
}

- (void)setIsAutoSelect:(BOOL)isAutoSelect{
    _isAutoSelect = isAutoSelect;
}

- (instancetype)initWithPickerMode:(ZJAddressPickerMode)pickerMode
{
    self = [super init];
    if (self) {
        self.isDataSourceValid          = YES;
        self.pickerViewMode         = pickerMode;
        self.isAutoSelect           = false;

//        _defaultSelectedArr         = defaultSelectedArr;
//        self.dataSource             = dataSource;
//        self.resultBlock            = resultBlock;
//        self.cancelBlock            = cancelBlock;
//        self.lineColor              = [UIColor la];
//        self.selecteRowTextColor    = selectRowTextColor;
//        self.selectRowBGColor       = selectRowBGColor;
        self.rowHeight              =  35.0f;
        [self loadAddressData];
        if (self.isDataSourceValid) {
            [self initWithAllView];
        }
    }
    return self;
}
#pragma mark - ÂàõÂª∫‰∏Ä‰∏™ pickerview
-(instancetype)initWithShowPickerViewMode:(ZJAddressPickerMode)pickerViewMode
                               dataSource:(NSArray *)dataSource
                          defaultSelected:(NSArray *)defaultSelectedArr
                           isAutoSelected:(BOOL)isAutoSelect
                                lineColor:(UIColor *)lineColor
                       selectRowTextColor:(UIColor *)selectRowTextColor
                         selectRowBGColor:(UIColor *)selectRowBGColor
                     confirmBtnTitleColor:(UIColor *)confirmBtnTitleColor
                      cancelBtnTitleColor:(UIColor *)cancelBtnTitleColor
                                rowHeight:(CGFloat)rowHeight
                              resultBlock:(ZJAddressResultBlock)resultBlock
                              cancelBlock:(ZJAddressCancelBlock)cancelBlock{
    
    if (self = [super init]) {
        _isDataSourceValid          = YES;
        self.pickerViewMode         = pickerViewMode;
        _defaultSelectedArr         = defaultSelectedArr;
        self.dataSource             = dataSource != nil ? dataSource : [NSArray array];
        self.resultBlock            = resultBlock;
        self.cancelBlock            = cancelBlock;
        self.isAutoSelect           = isAutoSelect;
//        self.lineColor              = lineColor;
        self.selecteRowTextColor    = selectRowTextColor;
        self.selectRowBGColor       = selectRowBGColor;
        self.rowHeight              = rowHeight ? rowHeight : 35.0f;
        
        
        if (confirmBtnTitleColor || cancelBtnTitleColor) {
            
            [self setUpConfirmTitleColor:confirmBtnTitleColor cancelColor:cancelBtnTitleColor];
        }
        
        [self loadAddressData];
        
        if (_isDataSourceValid) {
            [self initWithAllView];
        }
        
    }
    
    return self;
}
-(void)initWithAllView{
    [super initWithAllView];
    
    if (self.pickerViewMode == ZJAddressPickerModeProvince) {
        self.titleLab.text = @"ËØ∑ÈÄâÊã©ÁúÅ‰ªΩ";
    }else if (self.pickerViewMode == ZJAddressPickerModeCity){
        self.titleLab.text = @"ËØ∑ÈÄâÊã©ÂüéÂ∏Ç";
    }else{
        self.titleLab.text = @"ËØ∑ÈÄâÊã©Âú∞Âå∫";
    }
    [self.alertView addSubview:self.pickerView];
    
    [self.pickerView reloadAllComponents];
}

#pragma mark - Âä†ËΩΩÊï∞ÊçÆÊ∫ê
-(void)loadAddressData{
    if (!self.dataSource || self.dataSource.count == 0) {
        
        NSString *bundlePath = [[NSBundle mainBundle]pathForResource:@"ZJPickerViewBundle"ofType:@"bundle"];
        
        NSBundle *resourceBundle = [NSBundle bundleWithPath:bundlePath];
        
        NSString *filePath = [resourceBundle pathForResource:@"ZJAddress" ofType:@"plist"];
        NSArray *dataSource = [NSArray arrayWithContentsOfFile:filePath];
        
        if (!dataSource || dataSource.count == 0) {
            return;
        }
        self.dataSource = dataSource;
    }
    
    // Ëß£ÊûêÊï∞ÊçÆ
    [self parseDataSource];
    
    // ËÆæÁΩÆÈªòËÆ§ÂÄº
    [self setUpDefaultValue];

    // ËÆæÁΩÆÈªòËÆ§ÊªöÂä®
    [self scrollToRow:_provinceIndex secondRow:_cityIndex thirdRow:_areaIndex];
}

-(void)setUpDefaultValue{
    __block NSString *selectProvinceName = nil;
    __block NSString *selectCityName = nil;
    __block NSString *selectAreaName = nil;
    
    // 1. Ëé∑ÂèñÈªòËÆ§ÈÄâ‰∏≠ÁöÑÁúÅÂ∏ÇÂå∫ÂêçÁß∞
    if (_defaultSelectedArr) {
        if (_defaultSelectedArr.count > 0 && [_defaultSelectedArr[0] isKindOfClass:[NSString class]]) {
            selectProvinceName = _defaultSelectedArr[0];
        }
        
        if (_defaultSelectedArr.count > 1 && [_defaultSelectedArr[1] isKindOfClass:[NSString class]]) {
            selectCityName = _defaultSelectedArr[1];
        }
        if (_defaultSelectedArr.count > 2 && [_defaultSelectedArr[2] isKindOfClass:[NSString class]]) {
            selectAreaName = _defaultSelectedArr[2];
        }
    }
    
    // Ê†πÊçÆÂêçÁß∞Âø´ÈÄüÊâæÂà∞ÈªòËÆ§ÈÄâ‰∏≠ÁöÑÁúÅÂ∏ÇÂå∫Á¥¢Âºï
    @weakify(self)
    [self.provinceArr enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        @strongify(self);
        ZJProvinceModel *model = obj;
        
        if ([model.name isEqualToString:selectProvinceName]) {
            _provinceIndex = idx;
            self.selectProvinceModel = model;
            *stop = YES;
        }else{
            if (idx == self.provinceArr.count - 1) {
                _provinceIndex = 0;
                self.selectProvinceModel = [self.provinceArr firstObject];
            }
        }
    }];
    
    if (self.pickerViewMode == ZJAddressPickerModeCity || self.pickerViewMode == ZJAddressPickerModeArea) {
        self.cityArr = [self getCityModelArray:_provinceIndex];
        @weakify(self)
        [self.cityArr enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            @strongify(self)
            ZJCityModel *model = obj;
            if ([model.name isEqualToString:selectCityName]) {
                _cityIndex = idx;
                self.selectCityModel = model;
                *stop = YES;
            } else {
                if (idx == self.cityArr.count - 1) {
                    _cityIndex = 0;
                    self.selectCityModel = [self.cityArr firstObject];
                }
            }
        }];
    }
    if (self.pickerViewMode == ZJAddressPickerModeArea) {
        self.areaArr = [self getAreaModelArray:_provinceIndex cityIndex:_cityIndex];
        @weakify(self)
        [self.areaArr enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            @strongify(self)
            ZJAreaModel *model = obj;
            if ([model.name isEqualToString:selectAreaName]) {
                _areaIndex = idx;
                self.selectAreaModel = model;
                *stop = YES;
            } else {
                if (idx == self.cityArr.count - 1) {
                    _areaIndex = 0;
                    self.selectAreaModel = [self.areaArr firstObject];
                }
            }
        }];
    }
    
}
// Ê†πÊçÆ ÁúÅÁ¥¢Âºï Ëé∑Âèñ ÂüéÂ∏ÇÊ®°ÂûãÊï∞ÁªÑ
- (NSArray *)getCityModelArray:(NSInteger)provinceIndex {
    ZJProvinceModel *provinceModel = self.provinceArr[provinceIndex];
    // ËøîÂõûÂüéÂ∏ÇÊ®°ÂûãÊï∞ÁªÑ
    return provinceModel.citylist;
}

// Ê†πÊçÆ ÁúÅÁ¥¢ÂºïÂíåÂüéÂ∏ÇÁ¥¢Âºï Ëé∑Âèñ Âå∫ÂüüÊ®°ÂûãÊï∞ÁªÑ
- (NSArray *)getAreaModelArray:(NSInteger)provinceIndex cityIndex:(NSInteger)cityIndex {
    ZJProvinceModel *provinceModel = self.provinceArr[provinceIndex];
    ZJCityModel *cityModel = provinceModel.citylist[cityIndex];
    // ËøîÂõûÂú∞Âå∫Ê®°ÂûãÊï∞ÁªÑ
    return cityModel.arealist;
}

#pragma mark - Ëß£ÊûêÊï∞ÊçÆÊ∫ê
- (void)parseDataSource {
    NSMutableArray *tempArr1 = [NSMutableArray array];
    for (NSDictionary *proviceDic in self.dataSource) {
        ZJProvinceModel *proviceModel = [[ZJProvinceModel alloc]init];
        proviceModel.code = proviceDic[@"code"];
        proviceModel.name = proviceDic[@"name"];
        proviceModel.index = [self.dataSource indexOfObject:proviceDic];
        NSArray *citylist = proviceDic[@"citylist"];
        NSMutableArray *tempArr2 = [NSMutableArray array];
        for (NSDictionary *cityDic in citylist) {
            ZJCityModel *cityModel = [[ZJCityModel alloc]init];
            cityModel.code = cityDic[@"code"];
            cityModel.name = cityDic[@"name"];
            cityModel.index = [citylist indexOfObject:cityDic];
            NSArray *arealist = cityDic[@"arealist"];
            NSMutableArray *tempArr3 = [NSMutableArray array];
            for (NSDictionary *areaDic in arealist) {
                ZJAreaModel *areaModel = [[ZJAreaModel alloc]init];
                areaModel.code = areaDic[@"code"];
                areaModel.name = areaDic[@"name"];
                areaModel.index = [arealist indexOfObject:areaDic];
                [tempArr3 addObject:areaModel];
            }
            cityModel.arealist = [tempArr3 copy];
            [tempArr2 addObject:cityModel];
        }
        proviceModel.citylist = [tempArr2 copy];
        [tempArr1 addObject:proviceModel];
    }
    self.provinceArr = [tempArr1 copy];
}

#pragma mark - ÊªöÂä®Âà∞ÊåáÂÆöË°å
- (void)scrollToRow:(NSInteger)provinceIndex secondRow:(NSInteger)cityIndex thirdRow:(NSInteger)areaIndex {
    if (self.pickerViewMode == ZJAddressPickerModeProvince) {
        [self.pickerView selectRow:provinceIndex inComponent:0 animated:YES];
    } else if (self.pickerViewMode == ZJAddressPickerModeCity) {
        [self.pickerView selectRow:provinceIndex inComponent:0 animated:YES];
        [self.pickerView selectRow:cityIndex inComponent:1 animated:YES];
    } else if (self.pickerViewMode == ZJAddressPickerModeArea) {
        [self.pickerView selectRow:provinceIndex inComponent:0 animated:YES];
        [self.pickerView selectRow:cityIndex inComponent:1 animated:YES];
        [self.pickerView selectRow:areaIndex inComponent:2 animated:YES];
    }
}


#pragma mark - ËÉåÊôØËßÜÂõæÁöÑÁÇπÂáª‰∫ã‰ª∂
- (void)backViewTapAction:(UITapGestureRecognizer *)sender {
    [self dismissPickerViewWithAnimation:NO];
    if (self.cancelBlock) {
        self.cancelBlock();
    }
}

#pragma mark - ÂèñÊ∂àÊåâÈíÆÁöÑÁÇπÂáª‰∫ã‰ª∂
- (void)leftBtnClickAction:(UIButton *)sender {
    [self dismissPickerViewWithAnimation:YES];
    if (self.cancelBlock) {
        self.cancelBlock();
    }
}

#pragma mark - Á°ÆÂÆöÊåâÈíÆÁöÑÁÇπÂáª‰∫ã‰ª∂
- (void)rightBtnClickAction:(UIButton *)sender{
    [self dismissPickerViewWithAnimation:YES];
    // ÁÇπÂáªÁ°ÆÂÆöÊåâÈíÆÂêéÔºåÊâßË°åÂõûË∞É
    if(self.resultBlock) {
        self.resultBlock(self.selectProvinceModel, self.selectCityModel, self.selectAreaModel);
    }
}


#pragma mark - ÂºπÂá∫Á™óÂè£
-(void)showPickerViewWithAnimation:(BOOL)animation{
    UIWindow *keyWindow = [UIApplication sharedApplication].keyWindow;
    [keyWindow addSubview:self];
    
    if (animation) {
        CGRect rect = self.alertView.frame;
        rect.origin.y = ScreenHeight;
        self.alertView.frame = rect;
        
        [UIView animateWithDuration:0.3 animations:^{
            CGRect rect = self.alertView.frame;
            rect.origin.y -= kZJPickerHeight + kZJTopViewHeight +ZJ_BOTTOM_MARGIN;
            self.alertView.frame = rect;
        }];
    }
}
#pragma mark - ÂÖ≥Èó≠ËßÜÂõæÊñπÊ≥ï
- (void)dismissPickerViewWithAnimation:(BOOL)animation {
    // ÂÖ≥Èó≠Âä®Áîª
    [UIView animateWithDuration:0.2 animations:^{
        CGRect rect = self.alertView.frame;
        rect.origin.y += kZJPickerHeight + kZJTopViewHeight + ZJ_BOTTOM_MARGIN;
        self.alertView.frame = rect;
        self.backView.alpha = 0;
    } completion:^(BOOL finished) {
        [self removeFromSuperview];
    }];
}


#pragma amrk - UIPickerViewDelegate , UIPickerViewDataSource
// ËÆæÁΩÆ pickerView ‰∏äÊúâÂ§öÂ∞ëÂàó
-(NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView{
    
    if (self.pickerViewMode == ZJAddressPickerModeProvince) {
    
        return 1;
    
    }else if (self.pickerViewMode == ZJAddressPickerModeCity){
        
        return 2;
    
    }else if(self.pickerViewMode == ZJAddressPickerModeArea){
    
        return 3;
    }
    
    return 0;
    
}

// ËÆæÁΩÆ pickerview ‰∏äÊúâÂ§öÂ∞ëË°åÊï∞ÊçÆ
-(NSInteger)pickerView:(UIPickerView *)pickerView numberOfRowsInComponent:(NSInteger)component{
    if (component == 0) {
        // ËøîÂõûÁúÅÁöÑ‰∏™Êï∞
        return self.provinceArr.count;
    }
    
    if (component == 1) {
        // ËøîÂõûÂ∏ÇÁöÑ‰∏™Êï∞
        return self.cityArr.count;
    }
    
    if (component == 2) {
        // ËøîÂõûÂå∫ÁöÑ‰∏™Êï∞
        return self.areaArr.count;
    }
    
    return 0;

}


// ÈÖçÁΩÆ pickerView ÁöÑÊòæÁ§∫ÂÜÖÂÆπ,Âú®Ê≠§ÊñπÊ≥ï‰∏≠ÂÆûÁé∞ÁúÅ‰ªΩÂíåÂüéÂ∏ÇÈó¥ÁöÑËÅîÂä®
-(UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view{
    
//    if (self.lineColor) {
        // ËÆæÁΩÆÂàÜÂâ≤Á∫øÁöÑÈ¢úËâ≤
//        if (pickerView.subviews.count > 0) {
//            ((UIView *)[pickerView.subviews objectAtIndex:1]).backgroundColor = self.lineColor;
//            if (pickerView.subviews.count > 1) {
//                ((UIView *)[pickerView.subviews objectAtIndex:2]).backgroundColor = self.lineColor;

//            }
//        }
//    }
    

    UIView *backView = [[UIView alloc]initWithFrame:CGRectMake(0, 0, self.alertView.frame.size.width / 3, self.rowHeight * kScaleFit)];
    backView.backgroundColor = [UIColor clearColor];
    UILabel *label = [[UILabel alloc]initWithFrame:CGRectMake(5*kScaleFit, 0, (self.alertView.frame.size.width) / 3 - 10 * kScaleFit, self.rowHeight * kScaleFit)];
    [backView addSubview:label];
    label.backgroundColor = [UIColor clearColor];
    label.textAlignment = NSTextAlignmentCenter;
    label.font = kFontSize(18);
    label.adjustsFontSizeToFitWidth = YES;
    // Â≠ó‰ΩìËá™ÈÄÇÂ∫îÂ±ûÊÄß
    label.minimumScaleFactor = 0.5f;
    
    if (component == 0) {
        ZJProvinceModel *model = self.provinceArr[row];
        label.text = model.name;
        
        if (row == _provinceIndex && self.selecteRowTextColor) {
            label.textColor = self.selecteRowTextColor;
        }
        
    }else if (component == 1 ){
        ZJCityModel *model = self.cityArr[row];
        label.text = model.name;
        
        if (row == _cityIndex && self.selecteRowTextColor) {
            label.textColor = self.selecteRowTextColor;
        }
        
    }else if (component == 2 ){
        ZJAreaModel *model = self.areaArr[row];
        label.text = model.name;
        
        if (row == _areaIndex && self.selecteRowTextColor) {
            label.textColor = self.selecteRowTextColor;
        }

    }
    
    return backView;
}

// ËÆæÁΩÆ pickerview ÁöÑË°åÈ´ò
-(CGFloat)pickerView:(UIPickerView *)pickerView rowHeightForComponent:(NSInteger)component{
    return self.rowHeight * kScaleFit;
}

#pragma mark - pickerview ÁöÑÈÄâ‰∏≠ÂõûË∞É
-(void)pickerView:(UIPickerView *)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component{
    
    if (component == 0) {
        // ‰øùÂ≠òÈÄâÊã©ÁöÑÁúÅ‰ªΩÁöÑÁ¥¢Âºï
        _provinceIndex = row;
        switch (self.pickerViewMode) {
            case ZJAddressPickerModeProvince:
            {
                self.selectProvinceModel = self.provinceArr[_provinceIndex];
                self.selectCityModel = nil;
                self.selectAreaModel = nil;
                
            }
                break;
            case ZJAddressPickerModeCity:
            {
                self.cityArr = [self getCityModelArray:_provinceIndex];
                [self.pickerView reloadComponent:1];
                [self.pickerView selectRow:0 inComponent:1 animated:YES];
                self.selectProvinceModel = self.provinceArr[_provinceIndex];
                self.selectCityModel = self.cityArr[0];
                self.selectAreaModel = nil;
                _cityIndex = 0;
            }
                break;
            case ZJAddressPickerModeArea:
            {
                self.cityArr = [self getCityModelArray:_provinceIndex];
                self.areaArr = [self getAreaModelArray:_provinceIndex cityIndex:0];
                [self.pickerView reloadComponent:1];
                [self.pickerView selectRow:0 inComponent:1 animated:YES];
                [self.pickerView reloadComponent:2];
                [self.pickerView selectRow:0 inComponent:2 animated:YES];
                self.selectProvinceModel = self.provinceArr[_provinceIndex];
                self.selectCityModel = self.cityArr[0];
                self.selectAreaModel = self.areaArr[0];
                _cityIndex = 0;
                _areaIndex = 0;
            }
                break;
            default:
                break;
        }
    }
    
    if (component == 1) { // ÈÄâÊã©Â∏Ç
        // ‰øùÂ≠òÈÄâÊã©ÁöÑÂüéÂ∏ÇÁöÑÁ¥¢Âºï
        _cityIndex = row;
        switch (self.pickerViewMode) {
            case ZJAddressPickerModeCity:
            {
                self.selectCityModel = self.cityArr[_cityIndex];
                self.selectAreaModel = nil;
                
            }
                break;
            case ZJAddressPickerModeArea:
            {
                self.areaArr = [self getAreaModelArray:_provinceIndex cityIndex:_cityIndex];
                [self.pickerView reloadComponent:2];
                [self.pickerView selectRow:0 inComponent:2 animated:YES];
                self.selectCityModel = self.cityArr[_cityIndex];
                self.selectAreaModel = self.areaArr[0];
                _areaIndex = 0;
            }
                break;
            default:
                break;
        }
    }
    if (component == 2) { // ÈÄâÊã©Âå∫
        // ‰øùÂ≠òÈÄâÊã©ÁöÑÂú∞Âå∫ÁöÑÁ¥¢Âºï
        _areaIndex = row;
        if (self.pickerViewMode == ZJAddressPickerModeArea) {
            self.selectAreaModel = self.areaArr[_areaIndex];
        }
    }
    
    // Ëá™Âä®Ëé∑ÂèñÊï∞ÊçÆÔºåÊªöÂä®ÂÆåÂ∞±ÊâßË°åÂõûË∞É
    if (self.isAutoSelect) {
        if (self.resultBlock) {
            self.resultBlock(self.selectProvinceModel, self.selectCityModel, self.selectAreaModel);
        }
    }
    
    [pickerView reloadAllComponents];
}

-(void)layoutSubviews{
    [super layoutSubviews];
    if (self.subviews.count) {
        
        NSArray *subviews = self.pickerView.subviews;
        if (!(subviews.count > 0)) {
            return;
        }
        
        NSArray *coloms = subviews.firstObject;
        NSArray *subviewCache = [coloms valueForKey:@"subviewCache"];
        if (subviewCache.count > 0) {
            UIView *middleContainerView = [subviewCache.firstObject valueForKey:@"middleContainerView"];
            if (middleContainerView) {
                middleContainerView.backgroundColor = self.selectRowBGColor;
            }
        }
    }
    
}

#pragma mark - Getter && Setter
-(UIPickerView *)pickerView{
    if (!_pickerView) {
        _pickerView = [[UIPickerView alloc]initWithFrame:CGRectMake(0, kZJTopViewHeight + 0.5, self.alertView.frame.size.width, kZJPickerHeight)];
        _pickerView.dataSource = self;
        _pickerView.delegate = self;
        _pickerView.showsSelectionIndicator = YES;
        // ËÆæÁΩÆÂ≠êËßÜÂõæÁöÑÂ§ßÂ∞èÈöèÁùÄÁà∂ËßÜÂõæÂèòÂåñ
        _pickerView.autoresizingMask = UIViewAutoresizingFlexibleBottomMargin | UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleWidth;
    }
    return _pickerView;
}

-(NSArray *)dataSource{
    if (!_dataSource) {
        _dataSource = [NSArray array];
    }
    return _dataSource;
}

-(NSArray *)provinceArr{
    if (!_provinceArr) {
        _provinceArr = [NSArray array];
    }
    return _provinceArr;
}

-(NSArray *)cityArr{
    if (!_cityArr) {
        _cityArr = [NSArray array];
    }
    return _cityArr;
}

-(NSArray *)areaArr{
    if (!_areaArr) {
        _areaArr = [NSArray array];
    }
    return _areaArr;
}

-(ZJProvinceModel *)selectProvinceModel{
    if (!_selectProvinceModel) {
        _selectProvinceModel = [[ZJProvinceModel alloc]init];
    }
    return _selectProvinceModel;
}

-(ZJCityModel *)selectCityModel{
    if (!_selectCityModel) {
        _selectCityModel = [[ZJCityModel alloc]init];
        _selectCityModel.code = @"";
        _selectCityModel.name = @"";
    }
    return _selectCityModel;
}

-(ZJAreaModel *)selectAreaModel{
    if (!_selectAreaModel) {
        _selectAreaModel = [[ZJAreaModel alloc]init];
        _selectAreaModel.code = @"";
        _selectAreaModel.name = @"";
    }
    return _selectAreaModel;
}


@end
